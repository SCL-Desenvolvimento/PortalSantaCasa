<div class="container-fluid">
  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h3>Comunicados Internos</h3>
    <button class="btn btn-primary" (click)="showInternalAnnouncementForm()">
      <i class="fas fa-plus me-2"></i> Novo Comunicado
    </button>
  </div>

  <!-- Lista de Comunicados -->
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Título</th>
            <th>Publicado em</th>
            <th>Expira em</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let ann of internalAnnouncementList">
            <td>
              <div class="fw-bold">{{ ann.title }}</div>
              <div class="text-muted small">
                por {{ ann.userName || 'Usuário' }}
              </div>
            </td>
            <td>{{ ann.publishDate | date: 'dd/MM/yyyy' }}</td>
            <td>
              {{ ann.expirationDate ? (ann.expirationDate | date: 'dd/MM/yyyy') : 'Sem expiração' }}
            </td>
            <td>
              <span class="badge" [ngClass]="ann.isActive ? 'bg-success' : 'bg-danger'">
                {{ ann.isActive ? 'Ativo' : 'Inativo' }}
              </span>
            </td>
            <td>
              <div class="d-flex gap-2">
                <button class="btn btn-sm btn-outline-primary" title="Editar" (click)="showInternalAnnouncementForm(ann.id)">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" title="Excluir" (click)="deleteInternalAnnouncement(ann.id)">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>

          <tr *ngIf="!internalAnnouncementList?.length">
            <td colspan="5" class="text-center text-muted py-5">
              <i class="fas fa-bullhorn fa-3x mb-2"></i>
              <p>Nenhum comunicado cadastrado</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Paginação -->
    <div class="card-footer d-flex justify-content-between align-items-center">
      <button class="btn btn-outline-secondary btn-sm"
              [disabled]="currentPage === 1"
              (click)="changePage(currentPage - 1)">
        <i class="fas fa-chevron-left"></i> Anterior
      </button>

      <span>Página {{ currentPage }} de {{ totalPages }}</span>

      <button class="btn btn-outline-secondary btn-sm"
              [disabled]="currentPage === totalPages"
              (click)="changePage(currentPage + 1)">
        Próxima <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Modal -->
<div *ngIf="showModal" class="modal fade show d-block bg-dark bg-opacity-50" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <!-- Cabeçalho do Modal -->
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">{{ modalTitle }}</h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeModal()"></button>
      </div>

      <!-- Corpo do Modal -->
      <div class="modal-body">
        <form (ngSubmit)="saveInternalAnnouncement()" #internalAnnouncementFormRef="ngForm">
          <!-- Título -->
          <div class="mb-3">
            <label class="form-label">Título</label>
            <input type="text"
                   class="form-control"
                   [(ngModel)]="internalAnnouncementForm.title"
                   name="title"
                   required
                   maxlength="150">
          </div>

          <!-- Conteúdo -->
          <div class="mb-3">
            <label class="form-label">Conteúdo</label>
            <quill-editor [(ngModel)]="quillContent" name="content" [required]="true"></quill-editor>
          </div>

          <!-- Data de Publicação -->
          <div class="mb-3">
            <label class="form-label">Data de Publicação</label>
            <input type="date"
                   class="form-control"
                   [ngModel]="internalAnnouncementForm.publishDate | date:'yyyy-MM-dd'"
                   (ngModelChange)="setDate('publishDate', $event)"
                   name="publishDate"
                   required>
          </div>

          <!-- Data de Expiração -->
          <div class="mb-3">
            <label class="form-label">Data de Expiração</label>
            <input type="date"
                   class="form-control"
                   [ngModel]="internalAnnouncementForm.expirationDate | date:'yyyy-MM-dd'"
                   (ngModelChange)="setDate('expirationDate', $event)"
                   name="expirationDate">
          </div>

          <!-- Ativo -->
          <div class="form-check mb-3">
            <input type="checkbox"
                   class="form-check-input"
                   [(ngModel)]="internalAnnouncementForm.isActive"
                   name="isActive"
                   id="isActive">
            <label class="form-check-label" for="isActive">Ativo</label>
          </div>

          <!-- Botões -->
          <div class="d-flex justify-content-end gap-2">
            <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
            <button type="submit"
                    class="btn btn-success"
                    [disabled]="internalAnnouncementFormRef.invalid || !canSave()">
              {{ isEdit ? 'Atualizar' : 'Criar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
